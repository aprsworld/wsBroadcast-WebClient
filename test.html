<html>
<head>
<title>WS Broadcast Test</title>
<script src="res/jquery-2.1.4.min.js"></script>
<script src="res/swfobject-2.2.min.js"></script> <!-- SWFObject [Flash fallback for web_socket_js] -->
<script src="res/web-socket-js/web_socket.js"></script> <!-- git.com/gimite/web-socket-js WebSockets Compatibility Fall-Back library -->
<!-- Global Settings for web-socket-js library -->
<script>WEB_SOCKET_SWF_LOCATION = "res/web-socket-js/WebSocketMain.swf";</script>
<script src="js/wsb-client.js"></script> <!-- WebSockets Broadcast Client -->
<script>
function table_generate(data) {
	var $dtable = $('<table border=1></table>');
	for (var p in data) {
		var $drow = $('<tr></tr>');
		var $th = $('<th></th>');
		$th.text(p);
		$drow.append($th);
		// Nest Objects
		if (typeof data[p] === 'object') {
			$drow.append(table_generate(data[p]));
		} else {
			var $td = $('<td></td>');
			$td.text(data[p]);
			$drow.append($td);
		}
		$dtable.append($drow);
	}
	return $dtable;
}

function data_error (errors, reconnect_delay) {
	if (reconnect_delay > 0) {
		$('#wsdata').html('<strong>' + errors[0] + ':</strong> <em>Retrying in ' + reconnect_delay + 's.</em>');
	} else if (reconnect_delay < 0) {
		$('#wsdata').html('<strong>Unrecoverable Error: ' + errors[0] + '</strong>');
	} else {
		$('#wsdata').html('<strong>' + errors[0] + '</strong>');
	}
}

function data_update (data) {
	$('#wsdata').html(table_generate(data));
}

var data_object = null;
function data_start () {
	$('#wsdata').html('<strong>Connecting...</strong>');
	data_object = new BroadcastClient({
		callback_update: data_update,
		callback_error: data_error
	});
}
</script>
</head>

<body onload="data_start();">
<div id="header">
<h1>WS Broadcast Test</h1>
</div>

<div id="content">
<div id="wsdata">
<strong>THIS SITE REQUIRES JAVASCRIPT!</strong>
</div>
</div>

<div id="footer">
<br><hr>
&copy; Copyright 2015.<br>
ALL RIGHTS RESERVED!
</div>
</body>
</html>
